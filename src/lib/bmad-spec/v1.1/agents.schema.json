{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://crewagent.local/schemas/agents.schema.json",
  "title": "CrewAgent Agents Manifest",
  "type": "object",
  "required": ["schemaVersion", "agents"],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "pattern": "^1\\.1(\\.\\d+)?$"
    },
    "agents": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/agent" }
    }
  },
  "additionalProperties": false,
  "$defs": {
    "agentId": {
      "type": "string",
      "pattern": "^[A-Za-z0-9][A-Za-z0-9._:-]*$"
    },
    "nonEmptyString": {
      "type": "string",
      "minLength": 1
    },
    "toolPolicy": {
      "type": "object",
      "properties": {
        "fs": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "maxReadBytes": { "type": "integer", "minimum": 1 },
            "maxWriteBytes": { "type": "integer", "minimum": 1 }
          },
          "additionalProperties": false
        },
        "mcp": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": false },
            "allowedServers": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "agentMetadata": {
      "type": "object",
      "required": ["name", "title", "icon"],
      "properties": {
        "name": { "$ref": "#/$defs/nonEmptyString", "description": "Character/persona name (e.g., 'Amelia')." },
        "title": { "$ref": "#/$defs/nonEmptyString", "description": "Agent title (e.g., 'Developer Agent')." },
        "icon": { "$ref": "#/$defs/nonEmptyString", "description": "Emoji or short icon string." },
        "module": { "type": "string", "description": "Optional grouping/module slug (e.g., 'bmm')." },
        "description": { "type": "string" },
        "sourceId": { "type": "string", "description": "Optional original BMAD id/path (e.g., '_bmad/bmm/agents/dev.md')." }
      },
      "additionalProperties": false
    },
    "persona": {
      "type": "object",
      "required": ["role", "identity", "communication_style", "principles"],
      "properties": {
        "role": { "$ref": "#/$defs/nonEmptyString" },
        "identity": { "$ref": "#/$defs/nonEmptyString" },
        "communication_style": { "$ref": "#/$defs/nonEmptyString" },
        "principles": {
          "description": "Either a multi-line string or a list of principle strings.",
          "oneOf": [
            { "$ref": "#/$defs/nonEmptyString" },
            { "type": "array", "minItems": 1, "items": { "$ref": "#/$defs/nonEmptyString" } }
          ]
        }
      },
      "additionalProperties": false
    },
    "prompt": {
      "type": "object",
      "required": ["id", "content"],
      "properties": {
        "id": { "$ref": "#/$defs/nonEmptyString" },
        "content": { "$ref": "#/$defs/nonEmptyString" },
        "description": { "type": "string" }
      },
      "additionalProperties": false
    },
    "menuItem": {
      "type": "object",
      "required": ["description"],
      "properties": {
        "trigger": { "type": "string", "description": "Single trigger (kebab-case recommended)." },
        "triggers": { "type": "array", "items": { "type": "object", "additionalProperties": true } },
        "description": { "$ref": "#/$defs/nonEmptyString" },
        "workflow": { "type": "string" },
        "exec": { "type": "string" },
        "action": { "type": "string" },
        "data": { "type": "string" },
        "validate-workflow": { "type": "string" },
        "ide-only": { "type": "boolean" },
        "web-only": { "type": "boolean" }
      },
      "additionalProperties": true
    },
    "agent": {
      "type": "object",
      "required": ["id", "metadata", "persona"],
      "properties": {
        "id": { "$ref": "#/$defs/agentId" },
        "metadata": { "$ref": "#/$defs/agentMetadata" },
        "persona": { "$ref": "#/$defs/persona" },
        "critical_actions": {
          "type": "array",
          "items": { "$ref": "#/$defs/nonEmptyString" }
        },
        "prompts": {
          "type": "array",
          "items": { "$ref": "#/$defs/prompt" }
        },
        "menu": {
          "type": "array",
          "items": { "$ref": "#/$defs/menuItem" }
        },
        "systemPrompt": {
          "type": "string",
          "description": "Optional compiled system prompt. If omitted, Runtime may render from metadata/persona/critical_actions."
        },
        "userPromptTemplate": { "type": "string" },
        "discussion": { "type": "boolean" },
        "webskip": { "type": "boolean" },
        "conversational_knowledge": {
          "type": "array",
          "items": { "type": "object", "additionalProperties": true }
        },
        "tools": { "$ref": "#/$defs/toolPolicy" }
      },
      "additionalProperties": false
    }
  }
}
